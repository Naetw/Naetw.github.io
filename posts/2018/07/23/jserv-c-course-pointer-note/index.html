<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>  [Note] 你所不知道的 C 語言：指標篇
 | naetw's blog</title>

    <meta name="author" content="Naetw"/>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
    <link rel="stylesheet" href="https://naetw.github.io/theme/css/jquery.mglass.css"/>
    <link rel="stylesheet" href="https://naetw.github.io/theme/css/pygment-darkly.css"/>
    <link rel="stylesheet" href="https://naetw.github.io/theme/css/style.css"/>

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'/>


    <link rel="icon" href="https://naetw.github.io/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://naetw.github.io/favicon.ico" type="image/x-icon">

    <!-- Feeds -->
      <link href="https://naetw.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="naetw&#39;s blog - All posts - Atom Feed"/>
      <link href="https://naetw.github.io/feeds/note.atom.xml" type="application/atom+xml" rel="alternate" title="naetw&#39;s blog - Category: note - Atom Feed"/>


  </head>

  <body>

    <div class="container">

      <div class="page-header">
        <h1><a href="https://naetw.github.io">naetw's blog</a> <small></small></h1>
      </div>

      <nav class="navbar navbar-default">

        <!-- Hamburger menu for mobile -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://naetw.github.io" title="">naetw's blog</a>
        </div>

        <!-- Menus and search forms -->
        <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

          <ul class="nav navbar-nav">
<li >
                <a href="/archives">Archives</a>
              </li>
<li >
                <a href="/categories">Categories</a>
              </li>
<li >
                <a href="/tags">Tags</a>
              </li>
          </ul>



        </div>

      </nav>

    </div>


    <div class="container main">


      <div class="row">
        <div class=" col-md-9  ">
  <h1>
    <a href="https://naetw.github.io/posts/2018/07/23/jserv-c-course-pointer-note/" rel="bookmark" title="Permalink to [Note] 你所不知道的 C 語言：指標篇">[Note] 你所不知道的 C 語言：指標篇</a>
  </h1>
        </div>
      </div>

      <div class="row">


        <div class=" col-md-9 " id="content" role="main">
  

  <div>
    <blockquote>
<p>最近有空開始看 C 語言講座系列的直播，此系列主要記下 Jserv 在直播中提過但是沒有細講或是自己有興趣的內容。其餘內容請參閱下方共筆連結。</p>
<p><a href="https://hackmd.io/s/HyBPr9WGl">原始課程共筆連結</a></p>
</blockquote>
<h2>Declaration 的解讀</h2>
<h3>小小頭腦體操</h3>
<p>取自 <a href="http://www.literateprogramming.com/ctraps.pdf">C Traps and Pitfalls</a> 的案例 "Understanding Declarations"。</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span> <span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span> <span class="mi">0</span><span class="p">)();</span>
</pre></div>


<p>要理解上述的 statement，個人認為需要對執行程式的背後機制有些認識：</p>
<p>首先程式（狹義上可說可執行檔）是一個靜態的概念，是由一些指令（機器碼 machine code）以及資料所組成的檔案（machine code 其實也是資料，不過會被放在被標記為可執行的區塊中），要執行程式會需要將程式載入至記憶體中，再由 CPU 去抓取指令來執行，這個抓取的動作便需要有指令所在位置的資訊。以一個簡單的程式為例：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">func</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>在 main 中呼叫了 <code>func()</code> 這個函式，代表著此時 CPU 要去存放 <code>func()</code> 的指令的位址來讀機器碼，在 CPU 中有個 Program Counter（又稱 Instruction Pointer）的暫存器用來記錄此時執行到哪條指令，也就是該暫存器是儲存一個位址，而該位址所存放的資料便是機器碼。</p>
<p>可以用 <a href="https://www.gnu.org/software/binutils/">GNU Bintuils</a> 中的 <code>objdump</code> 來觀察，對可執行檔下以下指令：<code>objdump -d -M intel &lt;your executable file&gt;</code> 便可以觀察到如下資訊</p>
<div class="highlight"><pre><span></span>$ objdump -d -M intel a.out
...

Disassembly of section .text:

0000000100000f40 &lt;_func&gt;:
   100000f40:   55                      push   rbp
   100000f41:   48 89 e5                mov    rbp,rsp
   100000f44:   48 83 ec 10             sub    rsp,0x10
   ...

0000000100000f60 &lt;_main&gt;:
   100000f60:   55                      push   rbp
   100000f61:   48 89 e5                mov    rbp,rsp
   100000f64:   48 83 ec 10             sub    rsp,0x10
   100000f68:   c7 45 fc 00 00 00 00    mov    DWORD PTR [rbp-0x4],0x0
   100000f6f:   e8 cc ff ff ff          call   100000f40 &lt;_func&gt;
   ...
</pre></div>


<p>看到最下面的 <code>call 100000f40</code> 那行便是告訴 CPU 要到 <code>0x100000f40</code> 的位址去抓指令（*實際上 <code>call</code> 並非單純跳轉到其他地方去執行，它會儲存 return address 來幫助函式執行完可以回到原來的位置接下去執行*），而該位址所存的資料是 <code>0x554889e54883ec10</code>，這些資料經過解讀後就是上面可以看到的 <code>push rbp</code> ... 等等指令。</p>
<p>現在再回來看上面那個頭腦體操：</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span> <span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span> <span class="mi">0</span><span class="p">)();</span>
</pre></div>


<p>有了上面對函式呼叫的小認識，這裡的解讀應該就會輕鬆一些了：這個 statement 把 <code>0</code> 這個位址視作（轉型為）a pointer to a function returning void（也就是 <code>0</code> 是 pointer 存放的位址，而在這位址上的資料是 function 的位址），接著再用 indirection operator (<code>*</code>) 做 dereference 為 function designator 來做函式呼叫。</p>
<p>不過實際上上面的 statement 執行起來會是直接得到常見的 segmentation fault，這是因為 <code>0</code> 在大多數的作業系統中是被放在保留區 (reserved) 也就是不允許存取的區域。</p>
<h3>Clockwise/Spiral Rule</h3>
<h2>Trivial Stuff</h2>
<h3><code>func()</code> v.s. <code>func(void)</code> in C99</h3>
<div class="highlight"><pre><span></span><span class="c1">// Declaration</span>

<span class="kt">void</span> <span class="nf">func1</span><span class="p">();</span>      <span class="c1">// obsolescent</span>
<span class="kt">void</span> <span class="nf">func2</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>


<ul>
<li><code>func1</code> 沒有定義原型。（C99 specifies this as "function with no parameter specification". See <a href="http://port70.net/~nsz/c/c99/n1256.html#6.7.5.3p16">6.7.5.3p16</a>）</li>
<li><code>func2</code> 定義一個原型，這原型明確表示沒有任何 parameters。</li>
</ul>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Parameter_(computer_programming)#Parameters_and_arguments">parameter v.s. argument</a></p>
<ul>
<li>parameter (formal parameter)：在函式內用來代表參數的符號。</li>
<li>argument (actual argument)：傳入函式中實際上的值。</li>
</ul>
</blockquote>
<ul>
<li>
<p>延伸閱讀</p>
<ul>
<li><a href="https://stackoverflow.com/questions/41803937/func-vs-funcvoid-in-c99">func() vs func(void) in c99</a><ul>
<li>在 stackoverflow 上對這議題的討論。</li>
</ul>
</li>
<li><a href="https://stackoverflow.com/questions/18820751/identifier-list-vs-parameter-type-list-in-c">Difference between identifier list and parameter type list</a><ul>
<li>原來還有這種 Old Style 的宣告方式，難怪自己看白皮書的時候都不是很懂。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>va_arg (TODO)</p>
<ul>
<li>https://blog.csdn.net/astrotycoon/article/details/8284501</li>
</ul>
</li>
</ul>
<h2>Reference</h2>
<ul>
<li><a href="https://bit.ly/2K1P282">程式設計師的自我修養</a></li>
</ul>
  </div>


    <div class="comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'naetw-github-io';
        var disqus_identifier = "posts/2018/07/23/jserv-c-course-pointer-note/";
        var disqus_title = "[Note] 你所不知道的 C 語言：指標篇";
        var disqus_url = "https://naetw.github.io/posts/2018/07/23/jserv-c-course-pointer-note/";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.</noscript>
    </div>

        </div>

          <div class="col-md-3">
  <div class="well">

    <p><abbr title="2018-07-23T13:56:00+08:00"><i class="fa fa-calendar"></i> Mon 23 July 2018</abbr></p>

      <p><address>
        <i class="fa fa-user"></i> By
          <a href="https://naetw.github.io/author/naetw.html" rel="author">Naetw</a>
      </address></p>

    <hr/>

      <p>
              <a href="https://naetw.github.io/category/note/" rel="tag"
                  data-toggle="tooltip" class="label label-info"
                  title="5 articles in this category">note</a>
            <a href="/tag/c/" data-toggle="tooltip"
      class="label label-default"
      title="3 articles with this tag">C</a>
            <a href="/tag/ni-suo-bu-zhi-dao-de-c-yu-yan/" data-toggle="tooltip"
      class="label label-default"
      title="2 articles with this tag">你所不知道的 C 語言</a>
      </p>
      <hr/>



  </div>
            
          </div>

      </div>

    </div>

    <!-- TODO: make footer sticky -->
    <footer class="container-fluid">
      <div class="container">
        <div class="row">

            <div class="col-md-2">
                <h5>Social</h5>
                <ul class="list-unstyled">
                  <li>  <a href="https://github.com/Naetw">
      <i class="fa fa-github"></i>
    GitHub
  </a></li>
                </ul>
            </div>
            <div class="col-md-2">
                <h5>Links</h5>
                <ul class="list-unstyled">
                  <li>  <a href="http://getpelican.com/">
      <img src="https://besticon-demo.herokuapp.com/icon?url=getpelican.com&size=16" width="16" height="16" class="icon" alt="getpelican.com icon"/>
    Pelican
  </a></li>
                </ul>
            </div>

          <div class="col-md-2">
            <h5>Browse content by</h5>
            <ul class="list-unstyled">
                <li><a href="https://naetw.github.io/categories/index.html"><i class="fa fa-tags"></i> Categories</a></li>
                <li><a href="https://naetw.github.io/archives/index.html"><i class="fa fa-calendar"></i> Dates</a></li>
                <li><a href="https://naetw.github.io/tags/index.html"><i class="fa fa-tag"></i> Tags</a></li>
            </ul>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Copyright notice</h5>
            <p>© Copyright 2016-2019 Naetw.</p>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Disclaimer</h5>
              <p>All opinions expressed in this site are my own personal opinions and are not endorsed by, nor do they represent the opinions of my previous, current and future employers or any of its affiliates, partners or customers.</p>
          </div>

          <div class="col-md-2">
              <h5>Feeds</h5>
              <ul class="list-unstyled">
                  <li><small><a href="https://naetw.github.io/feeds/all.atom.xml"><i class="fa fa-rss"></i> All posts (Atom)</a></small></li>
                  <li><small><a href="https://naetw.github.io/feeds/note.atom.xml"><i class="fa fa-rss"></i> Category: note (Atom)</a></small></li>
              </ul>
          </div>

        </div>
      </div>

      <h5 class="text-right"><a href="#"><i class="fa fa-arrow-up"></i> Back to top</a></h5>

      <div class="container">
        <div class="row col-md-12 text-muted text-center">
          Site generated by <a href="https://getpelican.com"> Pelican</a>.<br/>
          <a href="https://github.com/kdeldycke/plumage"> Plumage</a> theme by <a href="https://kevin.deldycke.com">Kevin Deldycke</a>.
        </div>
      </div>

    </footer>

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-122098105-1', 'auto');
    ga('send', 'pageview');
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="https://naetw.github.io/theme/js/jquery.mglass.js"></script>
    <script src="https://naetw.github.io/theme/js/application.js"></script>

  </body>
</html>